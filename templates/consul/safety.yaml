{{- if and .Values.consul.enabled (and (not .Values.serviceAccount.create) (ne (include "service.fullname" .) .Values.serviceAccount.name)) }}
{{- fail (printf "Service and ServiceAccount names must match when Consul is enabled. Service=%s, serviceaccount=%s" (include "service.fullname" .) .Values.serviceAccount.name) }}
{{- else if and .Values.consul.enabled (and (not .Values.serviceAccount.name) (not .Values.serviceAccount.create)) }}
{{- fail (printf "ServiceAccount must be created when Consul is enabled") }}
{{- end }}
