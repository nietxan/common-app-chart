{{- if .Values.virtualService.enabled }}
apiVersion: {{ include "capabilities.virtualservice.apiVersion" .}}
kind: VirtualService
metadata:
  name: {{ include "service.fullname" . }}-vs
  namespace: {{ .Release.namespace }}
spec:
  {{- if .Values.virtualService.gateways}}
  gateways:
  {{- range .Values.virtualService.gateways }}
  - {{ . }}
  {{- end }}
  {{- end }}
  hosts:
  {{- range .Values.virtualService.hosts }}
  - {{ . }}
  {{- end }}
  http:
  - name: {{ include "service.fullname" . }}
    route: {{- include "virtualService.destination" . | indent 4 }}
    match:
    {{- if .Values.virtualService.uri.prefix }}
    {{- range .Values.virtualService.uri.prefix}}
    - uri:
        prefix: {{ . }}
    {{- end }}
    {{- end }}
    {{- if .Values.virtualService.uri.regex }}
    {{- range .Values.virtualService.uri.regex}}
    - uri:
        regex: {{ . }}
    {{- end }}
    {{- end }}
    {{- if .Values.virtualService.uri.exact }}
    {{- range .Values.virtualService.uri.exact}}
    - uri:
        exact: {{ . }}
    {{- end }}
    {{- end }}
{{- end }}